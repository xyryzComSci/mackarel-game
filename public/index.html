<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mackarel's Sweet Escape</title>
    <style>
        :root {
            --soft-pink: #ffdae9;
            --hot-pink: #ff85a1;
            --main-bg: #fff5f8;
            --accent: #fbc2eb;
            --text-dark: #6d4c41;
            --paper: #fffdf0;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--main-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-dark);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #hud {
            height: 70px;
            background: white;
            border-bottom: 4px solid var(--soft-pink);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        #inventory { display: flex; gap: 12px; }

        .inv-slot {
            width: 45px; height: 45px;
            background: var(--main-bg);
            border: 2px dashed var(--hot-pink);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
        }

        #viewport {
            flex-grow: 1;
            position: relative;
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        #room-container {
            position: relative;
            max-width: 600px;
            width: 100%;
            aspect-ratio: 1 / 1;
            background: #fefefe;
            border: 8px solid var(--soft-pink);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(255, 133, 161, 0.2);
            overflow: hidden;
        }

        #room-img { width: 100%; height: 100%; object-fit: cover; }

        #wall-photo-frame img { width: 100%; height: 100%; object-fit: cover; }

        /* Full Screen Photo Viewer Overlay */
        #photo-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: none; align-items: center; justify-content: center; z-index: 3000;
            flex-direction: column;
            cursor: pointer;
        }
        #photo-overlay img {
            max-width: 80%;
            max-height: 80%;
            border: 15px solid white;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #photo-overlay p { color: white; margin-top: 20px; font-weight: bold; font-family: sans-serif; }

        #message-bubble {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 20px 20px 0 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 220px;
            font-size: 14px;
            color: var(--text-dark);
            z-index: 60;
            border: 3px solid var(--soft-pink);
            display: none;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #action-text {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center;
            color: var(--hot-pink);
            font-weight: bold;
            font-size: 32px;
            pointer-events: none;
            z-index: 55;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            text-shadow: 2px 2px white, 0 0 10px rgba(255,255,255,0.8);
            opacity: 0;
        }

        .hitbox { position: absolute; cursor: pointer; z-index: 10; border-radius: 10px; }
        .hitbox:hover { background: rgba(255, 133, 161, 0.2); }

        .hitbox:hover::after {
            content: attr(data-label);
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 100;
        }

        #cat {
            position: absolute;
            width: 130px;
            height: 130px;
            pointer-events: none;
            z-index: 20;
            transition: all 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translate(-50%, -100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #cat-img {
            max-width: 100%;
            max-height: 100%;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
            object-fit: contain;
        }

        #modal-overlay {
            position: fixed; inset: 0; background: rgba(255, 218, 233, 0.8);
            display: none; align-items: center; justify-content: center; z-index: 1000;
        }

        .modal {
            background: white; padding: 30px; max-width: 350px; width: 85%;
            text-align: center; border-radius: 30px; border: 4px solid var(--hot-pink);
        }

        #win-screen {
            position: fixed; inset: 0; background: rgba(255, 245, 248, 0.95);
            display: none; align-items: center; justify-content: center; z-index: 2000;
            overflow-y: auto;
        }

        #closed-letter-view {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }
        #closed-letter-view:hover { transform: scale(1.05); }
        #closed-letter-img { width: 300px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.1)); }

        #open-letter-view {
            display: none;
            position: relative;
            align-items: center;
            justify-content: center;
        }

        .letter-content {
            background-image: url('letter.png');
            background-size: 100% 100%;
            background-color: var(--paper);
            width: 500px;
            min-height: 600px;
            padding: 60px 40px;
            box-sizing: border-box;
            position: relative;
            z-index: 2;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .cat-side-scene {
            position: absolute;
            left: -140px;
            bottom: 20px;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .cat-win-img { width: 180px; object-fit: contain; }
        .treats-img { width: 100px; margin-top: -40px; margin-left: 40px; object-fit: contain; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); }

        .choice-btns { display: flex; gap: 20px; margin-top: 30px; }
        
        #btn-yes { background: var(--hot-pink); color: white; border: none; padding: 12px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; transition: transform 0.2s; font-size: 18px; }
        #btn-yes:hover { transform: scale(1.1); }
        #btn-no { background: #ddd; color: #555; border: none; padding: 12px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 18px;}

        #no-msg { 
            height: 40px; 
            color: black; 
            font-size: 16px; 
            font-weight: bold; 
            margin-top: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #calendar-popup {
            position: absolute; inset: 0; background: white; border-radius: 10px;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10;
        }

        .cal-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 20px;
            text-align: center; font-family: monospace;
        }
        .cal-day { padding: 5px; width: 20px; }
        .cal-heart { background: var(--hot-pink); color: white; border-radius: 50%; }

        button {
            background: var(--hot-pink); color: white; border: none;
            padding: 12px 25px; border-radius: 50px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="hud">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 30px;">üê±</span>
        <div><div style="color: var(--hot-pink); font-weight: bold;">Mackarel's Escape</div></div>
    </div>
    <div id="inventory">
        <div class="inv-slot" id="slot-1"></div>
        <div class="inv-slot" id="slot-2"></div>
        <div class="inv-slot" id="slot-3"></div>
    </div>
</div>

<div id="viewport">
    <div id="room-container">
        <div id="action-text"></div>
        <div id="message-bubble"></div>

        <img id="room-img" src="room.png" alt="Room">
        
        <!-- Visible Poster Frame -->
        <div id="wall-photo-frame">
            <img src="cute.png" alt="Thumbnail">
        </div>
        
        <div class="hitbox" data-label="Locked Door" onclick="interact('door', 17, 30, 13, 35)" style="top:30%; left:17%; width:13%; height:35%;"></div>
        <div class="hitbox" data-label="Comfy Sofa" onclick="interact('sofa', 50, 48, 28, 28)" style="top:48%; left:50%; width:28%; height:28%;"></div>
        <div class="hitbox" data-label="Litter Box" onclick="interact('litter', 13, 59, 9, 14)" style="top:59%; left:13%; width:9%; height:14%;"></div>
        <div class="hitbox" data-label="Snack Drawer" onclick="interact('sideTable', 76, 58, 12, 20)" style="top:58%; left:76%; width:12%; height:20%;"></div>
        <div class="hitbox" data-label="Bookshelf" onclick="interact('bookshelf', 36, 26, 14, 35)" style="top:26%; left:36%; width:14%; height:35%;"></div>
        <div class="hitbox" data-label="Wall Poster" onclick="interact('poster', 11, 41, 6, 10)" style="top:41%; left:11%; width:6%; height:10%;"></div>

        <div id="cat" style="left: 60%; top: 75%;">
            <img id="cat-img" src="Loaf.png" alt="Mackarel">
        </div>
    </div>
</div>

<!-- Photo Pop-up Overlay -->
<div id="photo-overlay" onclick="this.style.display='none'">
    <img src="cute.png" alt="Full Image">
    <p>Click anywhere to close</p>
</div>

<div id="modal-overlay">
    <div class="modal" id="modal-content"></div>
</div>

<div id="win-screen">
    <div id="closed-letter-view" onclick="openLetter()">
        <img id="closed-letter-img" src="closed-letter.png" alt="Envelope">
        <h2 style="color: var(--hot-pink); margin-top: 15px;">A Letter for You! üíå</h2>
        <p>(Click to open)</p>
    </div>

    <div id="open-letter-view">
        <div class="cat-side-scene">
            <img src="Laughing.png" class="cat-win-img" alt="Happy Cat">
            <img src="treat.png" class="treats-img" alt="Treats">
        </div>

        <div class="letter-content">
            <div id="calendar-popup">
                <h1 style="color: var(--hot-pink);">THEN IT'S A DATE! üìÖ</h1>
                <div class="cal-grid">
                    <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                    <div></div><div></div><div></div><div>1</div><div>2</div><div>3</div><div>4</div>
                    <div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div>
                    <div>12</div><div>13</div><div class="cal-heart">14</div><div>15</div><div>16</div><div>17</div><div>18</div>
                </div>
                <p>See you on the 14th! ‚ù§Ô∏è</p>
            </div>

            <p style="left: -40%; position: absolute; top: 30%;">hehe i got the treatsies</p>
            <div id="no-msg"></div>
            <div style="top: 60%; position: absolute;" class="choice-btns">
                <button id="btn-yes" onclick="handleYes()">YES</button>
                <button id="btn-no" onclick="handleNo()">NO</button>
            </div>
        </div>
    </div>
</div>

<script>
    const catSprites = {
        default: 'Default.png',
        loaf: 'Loaf.png',
        litter: 'Litter.png',
        laughing: 'Laughing.png'
    };

    const inventory = [];
    const state = { hasKey: false, hasDial: false, drawerUnlocked: false };
    let noClickCount = 0;

    function setCatSprite(category) {
        document.getElementById('cat-img').src = catSprites[category] || catSprites.default;
    }

    function interact(key, left, top, w, h) {
        const cat = document.getElementById('cat');
        cat.style.left = (left + w/2) + '%';
        cat.style.top = (top + h) + '%';

        if (key === 'sofa') {
            setCatSprite('loaf');
        } else if (key === 'litter') {
            setCatSprite('litter');
        } else {
            setCatSprite('default');
        }

        setTimeout(() => handleLogic(key), 700);
    }

    function handleLogic(key) {
        switch(key) {
            case 'sofa':
                if (!state.hasKey) {
                    updateActionText("FOUND KEY! üîë");
                    addToInventory('key', 'üîë');
                    state.hasKey = true;
                    log("You scratched the sofa and found a key!");
                } else {
                    log("The sofa is nice and scratched.");
                }
                break;
            case 'litter': 
                log("You checked the litter box. Found a note!");
                updateActionText("FOUND CLUE '14' üìù");
                break;
            case 'door':
                if (inventory.includes('key')) {
                    log("You unlocked the door... it reveals a Calendar!");
                    showModal('clue-month');
                } else {
                    updateActionText("LOCKED! üîí");
                    log("The door is locked. Needs a key.");
                }
                break;
            case 'sideTable': 
                updateActionText("ENTER CODE üîí");
                showModal('keypad');
                break;
            case 'bookshelf':
                log("Just some boring books about fish.");
                break;
            case 'poster':
                log("A nice picture of mama and dada.");
                // Show the full size photo when interacting with poster
                document.getElementById('photo-overlay').style.display = 'flex';
                break;
        }
    }

    function updateActionText(text) {
        const el = document.getElementById('action-text');
        el.innerText = text;
        el.style.opacity = '1';
        setTimeout(() => el.style.opacity = '0', 2000);
    }

    function log(msg) {
        const bubble = document.getElementById('message-bubble');
        bubble.innerText = msg;
        bubble.style.display = 'block';
        bubble.style.animation = 'none';
        bubble.offsetHeight;
        bubble.style.animation = 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
    }

    function addToInventory(item, icon) {
        inventory.push(item);
        document.getElementById(`slot-${inventory.length}`).innerText = icon;
    }

    function showModal(type) {
        const overlay = document.getElementById('modal-overlay');
        const content = document.getElementById('modal-content');
        overlay.style.display = 'flex';

        if (type === 'clue-month') {
            content.innerHTML = `<h2>üìÖ CALENDAR</h2><p>It's open to <b>February (02)</b>.</p><button onclick="closeModal()">OK</button>`;
        } else if (type === 'keypad') {
            content.innerHTML = `
                <h2>SNACK DRAWER</h2>
                <p style="font-size: 12px;">(Hint: Month + Day)</p>
                <input type="text" id="code-input" maxlength="4" style="font-size: 24px; text-align: center; width: 100px;">
                <br><br>
                <button onclick="checkCode()">OPEN</button>
                <button onclick="closeModal()" style="background:#ccc; margin-left:10px;">BACK</button>
            `;
        }
    }

    function checkCode() {
        const val = document.getElementById('code-input').value;
        if (val === "0214") {
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('win-screen').style.display = 'flex';
        } else {
            updateActionText("WRONG CODE! üòø");
        }
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function openLetter() {
        document.getElementById('closed-letter-view').style.display = 'none';
        document.getElementById('open-letter-view').style.display = 'flex';
    }

    function handleYes() {
        document.getElementById('calendar-popup').style.display = 'flex';
    }

    function handleNo() {
        noClickCount++;
        const msg = document.getElementById('no-msg');
        const btnNo = document.getElementById('btn-no');

        if (noClickCount === 1) {
            msg.innerText = "Are you sure?";
        } else if (noClickCount === 2) {
            msg.innerText = "Meow (Mackarel says mama say yes)";
        } else if (noClickCount === 3) {
            msg.innerText = "";
            btnNo.innerText = "YES ABSOLUTELY";
            btnNo.style.background = "var(--hot-pink)";
            btnNo.style.color = "white";
            btnNo.onclick = handleYes; 
        }
    }

    window.onload = () => {
        setCatSprite('loaf');
        log("Mackarel smells snacks in the drawer. It's locked!");
    };
</script>
</body>
</html>